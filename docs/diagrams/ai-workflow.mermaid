graph TB
    %% User Input
    subgraph "User Interaction"
        USER_QUERY["User Query<br/>(Natural Language)"]
        CHAT_INTERFACE["Chat Interface<br/>(WebSocket)"]
        CONTEXT_INPUT["Context Input<br/>(Current Findings)"]
    end

    %% AI Processing Pipeline
    subgraph "AI Processing Pipeline"
        QUERY_ANALYZER["Query Analyzer<br/>(Intent Detection)"]
        INTENT_CLASSIFIER["Intent Classifier<br/>(Action Determination)"]
        CONTEXT_BUILDER["Context Builder<br/>(Relevant Data)"]
    end

    %% Bedrock Agent
    subgraph "Bedrock Agent Core"
        AGENT_CORE["Agent Core<br/>(Conversation Manager)"]
        ORCHESTRATOR["Action Orchestrator<br/>(Workflow Control)"]
        RESPONSE_GENERATOR["Response Generator<br/>(Natural Language)"]
    end

    %% Action Groups
    subgraph "Action Groups"
        SCAN_ACTION["Scan Actions<br/>(Scan Management)"]
        FINDING_ACTION["Finding Actions<br/>(Issue Management)"]
        REMEDIATION action["Remediation Actions<br/>(Fix Automation)"]
        REPORT_ACTION["Report Actions<br/>(Documentation)"]
        TERRAFORM_ACTION["Terraform Actions<br/>(IaC Analysis)"]
        S3_ACTION["S3 Actions<br/>(File Management)"]
    end

    %% Knowledge Base
    subgraph "Knowledge Base"
        SOC2_DOCS["SOC 2 Documentation<br/>(Trust Criteria)"]
        HIPAA_DOCS["HIPAA Guidelines<br/>(Healthcare Rules)"]
        PCI_DOCS["PCI-DSS Standards<br/>(Payment Security)"]
        AWS_DOCS["AWS Best Practices<br/>(Cloud Security)"]
        COMPLIANCE_DB["Compliance Database<br/>(Rule Mappings)"]
    end

    %% Data Sources
    subgraph "Data Sources"
        FINDINGS_DB["Findings Database<br/>(Current Issues)"]
        SCAN_RESULTS["Scan Results<br/>(Recent Data)"]
        USER_CONFIG["User Configuration<br/>(Preferences)"]
        AUDIT_HISTORY["Audit History<br/>(Past Actions)"]
    end

    %% Response Generation
    subgraph "Response Generation"
        TEMPLATE_ENGINE["Template Engine<br/>(Structured Output)"]
        CONFIDENCE_SCORER["Confidence Scorer<br/>(Reliability Check)"]
        SOURCE_CITATION["Source Citation<br/>(Reference Linking)"]
        ACTION_RECOMMENDER["Action Recommender<br/>(Next Steps)"]
    end

    %% User Output
    subgraph "User Output"
        TEXT_RESPONSE["Text Response<br/>(Natural Language Answer)"]
        ACTION_TRIGGERED["Action Triggered<br/>(Workflow Initiated)"]
        VISUAL_AIDS["Visual Aids<br/>(Charts & Diagrams)"]
        FOLLOW_UP["Follow-up Questions<br/>(Interactive Guide)"]
    end

    %% Flow Connections
    USER_QUERY --> CHAT_INTERFACE
    CONTEXT_INPUT --> CHAT_INTERFACE
    CHAT_INTERFACE --> QUERY_ANALYZER

    QUERY_ANALYZER --> INTENT_CLASSIFIER
    INTENT_CLASSIFIER --> CONTEXT_BUILDER
    CONTEXT_BUILDER --> AGENT_CORE

    AGENT_CORE --> ORCHESTRATOR
    ORCHESTRATOR --> RESPONSE_GENERATOR

    ORCHESTRATOR --> SCAN_ACTION
    ORCHESTRATOR --> FINDING_ACTION
    ORCHESTRATOR --> REMEDIATION_ACTION
    ORCHESTRATOR --> REPORT_ACTION
    ORCHESTRATOR --> TERRAFORM_ACTION
    ORCHESTRATOR --> S3_ACTION

    AGENT_CORE --> SOC2_DOCS
    AGENT_CORE --> HIPAA_DOCS
    AGENT_CORE --> PCI_DOCS
    AGENT_CORE --> AWS_DOCS
    AGENT_CORE --> COMPLIANCE_DB

    CONTEXT_BUILDER --> FINDINGS_DB
    CONTEXT_BUILDER --> SCAN_RESULTS
    CONTEXT_BUILDER --> USER_CONFIG
    CONTEXT_BUILDER --> AUDIT_HISTORY

    RESPONSE_GENERATOR --> TEMPLATE_ENGINE
    TEMPLATE_ENGINE --> CONFIDENCE_SCORER
    CONFIDENCE_SCORER --> SOURCE_CITATION
    SOURCE_CITATION --> ACTION_RECOMMENDER

    ACTION_RECOMMENDER --> TEXT_RESPONSE
    ACTION_RECOMMENDER --> ACTION_TRIGGERED
    ACTION_RECOMMENDER --> VISUAL_AIDS
    ACTION_RECOMMENDER --> FOLLOW_UP

    %% Styling
    classDef interaction fill:#e8f5e8
    classDef processing fill:#e3f2fd
    classDef bedrock fill:#fff3e0
    classDef actions fill:#fce4ec
    classDef knowledge fill:#f3e5f5
    classDef data fill:#e0f2f1
    classDef response fill:#f1f8e9
    classDef output fill:#e8eaf6

    class USER_QUERY,CHAT_INTERFACE,CONTEXT_INPUT interaction
    class QUERY_ANALYZER,INTENT_CLASSIFIER,CONTEXT_BUILDER processing
    class AGENT_CORE,ORCHESTRATOR,RESPONSE_GENERATOR bedrock
    class SCAN_ACTION,FINDING_ACTION,REMEDIATION_ACTION,REPORT_ACTION,TERRAFORM_ACTION,S3_ACTION actions
    class SOC2_DOCS,HIPAA_DOCS,PCI_DOCS,AWS_DOCS,COMPLIANCE_DB knowledge
    class FINDINGS_DB,SCAN_RESULTS,USER_CONFIG,AUDIT_HISTORY data
    class TEMPLATE_ENGINE,CONFIDENCE_SCORER,SOURCE_CITATION,ACTION_RECOMMENDER response
    class TEXT_RESPONSE,ACTION_TRIGGERED,VISUAL_AIDS,FOLLOW_UP output
